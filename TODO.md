# 実装TODO - Shopping Assistant

## Phase 1: プロジェクト基盤構築

### 1.1 プロジェクトセットアップ
- [ ] Flutter プロジェクト作成
- [ ] ディレクトリ構造の作成（CLAUDE.mdのレイヤード構造に従う）
- [ ] 必要パッケージの追加
  - [ ] `dio` - HTTPクライアント
  - [ ] `flutter_riverpod` - 状態管理
  - [ ] `freezed` / `json_serializable` - モデル生成
  - [ ] `shared_preferences` - ローカル設定保存
  - [ ] `flutter_secure_storage` - APIキー保護
  - [ ] `cached_network_image` - 画像キャッシュ

### 1.2 共通基盤
- [ ] 環境設定クラス（`--dart-define`からAPIキー取得）
- [ ] Dio インスタンス設定（インターセプター、タイムアウト、リトライ）
- [ ] 共通エラーハンドリング（NetworkException, RateLimitException等）
- [ ] ロギングユーティリティ

---

## Phase 2: データ層実装

### 2.1 統一商品モデル
- [ ] `Product` モデル定義（freezed使用）
  ```dart
  // 必須フィールド
  - id, title, price, imageUrl, productUrl, source(EC種別)
  // オプション
  - shippingCost, pointRate, pointValue, reviewScore, reviewCount
  ```
- [ ] `effectivePrice` 計算ロジック実装

### 2.2 Amazon APIクライアント
- [ ] PA-API v5 署名生成ロジック
- [ ] 商品検索エンドポイント実装
- [ ] レスポンス → Product モデル変換
- [ ] レート制限ハンドリング（1req/sec）

### 2.3 楽天APIクライアント
- [ ] 楽天商品検索API実装
- [ ] affiliateId パラメータ対応
- [ ] ポイント倍率（pointRate）のパース
- [ ] 送料フラグ（postageFlag）の処理

### 2.4 Yahoo!ショッピングAPIクライアント
- [ ] 商品検索API実装
- [ ] ValueCommerce アフィリエイト対応
- [ ] 送料コード解析（無料/条件付き無料）
- [ ] ポイント構造のパース

### 2.5 Qoo10対応（後回し可）
- [ ] スクレイピング方針決定（自前 or Apify）
- [ ] 基本的な商品データ取得
- [ ] 利用規約リスクの確認・対策

### 2.6 リポジトリ層
- [ ] `ProductRepository` 実装
- [ ] `Future.wait()` による並列検索
- [ ] 個別エラー時の部分結果返却ロジック
- [ ] 結果のマージ・重複排除

---

## Phase 3: ドメイン層実装

### 3.1 検索サービス
- [ ] `SearchService` 実装
- [ ] 検索クエリのバリデーション
- [ ] 結果のソート（実質価格順、価格順、ポイント順）
- [ ] フィルタリング（価格範囲、送料無料、ポイント倍率）

### 3.2 設定サービス
- [ ] `SettingsService` 実装
- [ ] 検索対象サイトの保存/読み込み
- [ ] ユーザー設定の永続化

---

## Phase 4: プレゼンテーション層実装

### 4.1 Riverpod プロバイダー
- [ ] `searchResultsProvider` - 検索結果管理
- [ ] `selectedSitesProvider` - サイト選択状態
- [ ] `searchQueryProvider` - 検索クエリ
- [ ] `sortOptionProvider` - ソート設定
- [ ] `filterOptionsProvider` - フィルター設定

### 4.2 画面実装
- [ ] **検索画面**: 検索バー、サイト選択トグル
- [ ] **結果一覧画面**: 商品カード、ソート/フィルターUI
- [ ] **商品詳細画面**: 価格比較表、各サイトへのリンク
- [ ] **設定画面**: サイト選択、表示設定

### 4.3 UIコンポーネント
- [ ] 商品カードウィジェット（画像、価格、実質価格、ポイント表示）
- [ ] サイトバッジ（Amazon/楽天/Yahoo/Qoo10アイコン）
- [ ] 価格比較バー（視覚的な価格差表示）
- [ ] ローディング/エラー状態表示
- [ ] サイトごとのステータスインジケーター

---

## Phase 5: 品質・リリース準備

### 5.1 エラーハンドリング強化
- [ ] ネットワークエラー時のUI表示
- [ ] レート制限時のリトライUI
- [ ] オフラインモード対応（キャッシュ表示）

### 5.2 テスト
- [ ] APIクライアントのユニットテスト（モック使用）
- [ ] リポジトリ層のテスト（並列処理、エラーケース）
- [ ] ウィジェットテスト
- [ ] インテグレーションテスト

### 5.3 コンプライアンス対応
- [ ] アフィリエイト表記の追加（About画面）
- [ ] プライバシーポリシー画面
- [ ] 利用規約画面

### 5.4 リリース準備
- [ ] アプリアイコン作成
- [ ] スプラッシュスクリーン
- [ ] ストア掲載用スクリーンショット
- [ ] iOS: App Store Connect 設定
- [ ] Android: Google Play Console 設定

---

## Phase 6: 将来拡張（オプション）

### 6.1 画像検索機能
- [ ] カメラ/ギャラリーからの画像取得
- [ ] Vision API 連携（Google ML Kit or AWS Rekognition）
- [ ] 画像からキーワード抽出 → 検索実行

### 6.2 お気に入り・履歴機能
- [ ] お気に入り商品の保存
- [ ] 検索履歴の保存
- [ ] 価格変動アラート

### 6.3 パフォーマンス最適化
- [ ] 検索結果のキャッシュ
- [ ] 画像の事前読み込み
- [ ] 無限スクロール対応

---

## 実装優先度ガイド

| 優先度 | 内容 | 理由 |
|--------|------|------|
| 🔴 高 | Phase 1-2 | 基盤なしでは何も動かない |
| 🟠 中 | Phase 3-4 | ユーザー体験の核心部分 |
| 🟡 低 | Phase 5 | リリース前に必須だが後回し可 |
| 🟢 任意 | Phase 6 | MVP後の拡張機能 |

---

## 技術的注意点

1. **APIキーは絶対にコミットしない** → `.gitignore` に環境ファイル追加必須
2. **レート制限を尊重** → 各API 1req/sec を守る実装
3. **Qoo10は慎重に** → スクレイピングリスクを理解した上で判断
4. **実質価格の計算は統一** → 全サイトで同じロジック適用
